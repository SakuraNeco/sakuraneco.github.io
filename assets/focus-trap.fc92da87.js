import{l as ne,e as se,f as oe,_ as re}from"./index.60fdf40a.js";import{n as ae,k as P,J as v,a5 as ce,j as ue,C as ie,a6 as de,B as L,i as H,U as N,y,q as fe,a7 as le,a8 as pe,A as B,a2 as Ee,r as ve}from"./index.b181e559.js";function ke(e){return e===void 0}class me extends Error{constructor(n){super(n),this.name="ElementPlusError"}}function De(e,n){throw new me(`[${e}] ${n}`)}function Ke(e,n){}const Ve=ae([String,Object,Function]),$e={validating:ne,success:se,error:oe},Z={tab:"Tab",enter:"Enter",space:"Space",left:"ArrowLeft",up:"ArrowUp",right:"ArrowRight",down:"ArrowDown",esc:"Escape",delete:"Delete",backspace:"Backspace",numpadEnter:"NumpadEnter",pageUp:"PageUp",pageDown:"PageDown",home:"Home",end:"End"},je="update:modelValue",xe="change",He="input",Be=({from:e,replacement:n,scope:s,version:o,ref:a,type:i="API"},f)=>{P(()=>v(f),m=>{},{immediate:!0})},M={prefix:Math.floor(Math.random()*1e4),current:0},Te=Symbol("elIdInjection"),Fe=()=>ie()?de(Te,M):M,Me=e=>{const n=Fe(),s=ce();return ue(()=>v(e)||`${s.value}-id-${n.prefix}-${n.current++}`)};let E=[];const q=e=>{const n=e;n.key===Z.esc&&E.forEach(s=>s(n))},_e=e=>{L(()=>{E.length===0&&document.addEventListener("keydown",q),H&&E.push(e)}),N(()=>{E=E.filter(n=>n!==e),E.length===0&&H&&document.removeEventListener("keydown",q)})},I="focus-trap.focus-after-trapped",S="focus-trap.focus-after-released",be="focus-trap.focusout-prevented",J={cancelable:!0,bubbles:!1},Pe={cancelable:!0,bubbles:!1},W="focusAfterTrapped",G="focusAfterReleased",ye=Symbol("elFocusTrap"),O=y(),w=y(0),R=y(0);let F=0;const ee=e=>{const n=[],s=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:o=>{const a=o.tagName==="INPUT"&&o.type==="hidden";return o.disabled||o.hidden||a?NodeFilter.FILTER_SKIP:o.tabIndex>=0||o===document.activeElement?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;s.nextNode();)n.push(s.currentNode);return n},Y=(e,n)=>{for(const s of e)if(!we(s,n))return s},we=(e,n)=>{if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(n&&e===n)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1},ge=e=>{const n=ee(e),s=Y(n,e),o=Y(n.reverse(),e);return[s,o]},he=e=>e instanceof HTMLInputElement&&"select"in e,p=(e,n)=>{if(e&&e.focus){const s=document.activeElement;e.focus({preventScroll:!0}),R.value=window.performance.now(),e!==s&&he(e)&&n&&e.select()}};function z(e,n){const s=[...e],o=e.indexOf(n);return o!==-1&&s.splice(o,1),s}const Ce=()=>{let e=[];return{push:o=>{const a=e[0];a&&o!==a&&a.pause(),e=z(e,o),e.unshift(o)},remove:o=>{var a,i;e=z(e,o),(i=(a=e[0])==null?void 0:a.resume)==null||i.call(a)}}},Ie=(e,n=!1)=>{const s=document.activeElement;for(const o of e)if(p(o,n),document.activeElement!==s)return},Q=Ce(),Se=()=>w.value>R.value,_=()=>{O.value="pointer",w.value=window.performance.now()},X=()=>{O.value="keyboard",w.value=window.performance.now()},Le=()=>(L(()=>{F===0&&(document.addEventListener("mousedown",_),document.addEventListener("touchstart",_),document.addEventListener("keydown",X)),F++}),N(()=>{F--,F<=0&&(document.removeEventListener("mousedown",_),document.removeEventListener("touchstart",_),document.removeEventListener("keydown",X))}),{focusReason:O,lastUserFocusTimestamp:w,lastAutomatedFocusTimestamp:R}),b=e=>new CustomEvent(be,{...Pe,detail:e}),Ne=fe({name:"ElFocusTrap",inheritAttrs:!1,props:{loop:Boolean,trapped:Boolean,focusTrapEl:Object,focusStartEl:{type:[Object,String],default:"first"}},emits:[W,G,"focusin","focusout","focusout-prevented","release-requested"],setup(e,{emit:n}){const s=y();let o,a;const{focusReason:i}=Le();_e(t=>{e.trapped&&!f.paused&&n("release-requested",t)});const f={paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}},m=t=>{if(!e.loop&&!e.trapped||f.paused)return;const{key:r,altKey:c,ctrlKey:u,metaKey:d,currentTarget:$,shiftKey:j}=t,{loop:x}=e,te=r===Z.tab&&!c&&!u&&!d,T=document.activeElement;if(te&&T){const g=$,[h,C]=ge(g);if(h&&C){if(!j&&T===C){const l=b({focusReason:i.value});n("focusout-prevented",l),l.defaultPrevented||(t.preventDefault(),x&&p(h,!0))}else if(j&&[h,g].includes(T)){const l=b({focusReason:i.value});n("focusout-prevented",l),l.defaultPrevented||(t.preventDefault(),x&&p(C,!0))}}else if(T===g){const l=b({focusReason:i.value});n("focusout-prevented",l),l.defaultPrevented||t.preventDefault()}}};le(ye,{focusTrapRef:s,onKeydown:m}),P(()=>e.focusTrapEl,t=>{t&&(s.value=t)},{immediate:!0}),P([s],([t],[r])=>{t&&(t.addEventListener("keydown",m),t.addEventListener("focusin",k),t.addEventListener("focusout",D)),r&&(r.removeEventListener("keydown",m),r.removeEventListener("focusin",k),r.removeEventListener("focusout",D))});const A=t=>{n(W,t)},U=t=>n(G,t),k=t=>{const r=v(s);if(!r)return;const c=t.target,u=t.relatedTarget,d=c&&r.contains(c);e.trapped||u&&r.contains(u)||(o=u),d&&n("focusin",t),!f.paused&&e.trapped&&(d?a=c:p(a,!0))},D=t=>{const r=v(s);if(!(f.paused||!r))if(e.trapped){const c=t.relatedTarget;!pe(c)&&!r.contains(c)&&setTimeout(()=>{if(!f.paused&&e.trapped){const u=b({focusReason:i.value});n("focusout-prevented",u),u.defaultPrevented||p(a,!0)}},0)}else{const c=t.target;c&&r.contains(c)||n("focusout",t)}};async function K(){await B();const t=v(s);if(t){Q.push(f);const r=t.contains(document.activeElement)?o:document.activeElement;if(o=r,!t.contains(r)){const u=new Event(I,J);t.addEventListener(I,A),t.dispatchEvent(u),u.defaultPrevented||B(()=>{let d=e.focusStartEl;Ee(d)||(p(d),document.activeElement!==d&&(d="first")),d==="first"&&Ie(ee(t),!0),(document.activeElement===r||d==="container")&&p(t)})}}}function V(){const t=v(s);if(t){t.removeEventListener(I,A);const r=new CustomEvent(S,{...J,detail:{focusReason:i.value}});t.addEventListener(S,U),t.dispatchEvent(r),!r.defaultPrevented&&(i.value=="keyboard"||!Se()||t.contains(document.activeElement))&&p(o!=null?o:document.body),t.removeEventListener(S,U),Q.remove(f)}}return L(()=>{e.trapped&&K(),P(()=>e.trapped,t=>{t?K():V()})}),N(()=>{e.trapped&&V()}),{onKeydown:m}}});function Oe(e,n,s,o,a,i){return ve(e.$slots,"default",{handleKeydown:e.onKeydown})}var qe=re(Ne,[["render",Oe],["__file","focus-trap.vue"]]);export{xe as C,qe as E,He as I,je as U,$e as V,ke as a,Be as b,Fe as c,Ke as d,Z as e,Ve as i,De as t,Me as u};
